From ef4688260b28a6563f33f704fbbc757fad050308 Mon Sep 17 00:00:00 2001
From: honjow <honjow311@gmail.com>
Date: Sat, 28 Feb 2026 21:25:11 +0800
Subject: [PATCH 5/5] mangoapp: always use full-screen window size for overlay

Revert the non-horizontal layout to use screenWidth x screenHeight,
matching v0.8.2 behavior. Shrinking the window to the HUD size corrupts
ImGui's DisplaySize, breaking position_layer() calculations, and causes
Gamescope to misplace the overlay in rotated/non-native landscape
coordinate spaces (overlay ending up in bottom-right corner).

The horizontal layout already reverted to full-screen for the same
direct scanout reasons; apply the same logic consistently.
---
 src/app/main.cpp | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/src/app/main.cpp b/src/app/main.cpp
index 2dbed1a..1cd0187 100644
--- a/src/app/main.cpp
+++ b/src/app/main.cpp
@@ -306,12 +306,13 @@ static bool render(GLFWwindow* window, overlay_params& real_params) {
     int w, h;
     glfwGetWindowSize(window, &w, &h);
     window_size_changed = w != window_size.x || h != window_size.y;
-    if (real_params.enabled[OVERLAY_PARAM_ENABLED_horizontal])
-    // trying to reduce height will break direct scanout in some cases
-    // just leave it for now, we'll revisit it in server
+    // Always use full-screen window size so Gamescope composites the overlay
+    // correctly in all orientations (including non-native landscape devices).
+    // Reducing window size causes Gamescope to misplace the overlay in rotated
+    // coordinate spaces, and also corrupts ImGui's DisplaySize which breaks
+    // position_layer() calculations for non-horizontal layouts.
+    if (screenWidth && screenHeight)
         glfwSetWindowSize(window, screenWidth, screenHeight);
-    else
-        glfwSetWindowSize(window, window_size.x, window_size.y);
 
     ImGui::EndFrame();
 
-- 
2.53.0

