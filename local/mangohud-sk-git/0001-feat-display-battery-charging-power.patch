From adb29f7a78f175e123c6aa5a9f14f267fd5d56b4 Mon Sep 17 00:00:00 2001
From: honjow <honjow311@gmail.com>
Date: Sun, 22 Feb 2026 09:36:55 +0800
Subject: [PATCH 1/3] feat: display battery charging power

- Display actual power value during battery charging
- Add +/- prefix to power value to indicate charging/discharging status
---
 src/battery.cpp      | 2 +-
 src/hud_elements.cpp | 8 +++++++-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/src/battery.cpp b/src/battery.cpp
index 1612bff..51bf62a 100644
--- a/src/battery.cpp
+++ b/src/battery.cpp
@@ -106,7 +106,7 @@ float BatteryStats::getPower() {
             }
         }
 
-        if (state[i] == "Charging" || state[i] == "Unknown" || state[i] == "Full") {
+        if (state[i] != "Charging" && state[i] != "Discharging") {
             // TODO if we have multiple batteries, we will return 0 if just one of them is charging
             return 0.0f;
         }
diff --git a/src/hud_elements.cpp b/src/hud_elements.cpp
index e9e365d..7359580 100644
--- a/src/hud_elements.cpp
+++ b/src/hud_elements.cpp
@@ -1250,13 +1250,19 @@ void HudElements::battery(){
             if (Battery_Stats.current_watt != 0) {
                 if (HUDElements.params->enabled[OVERLAY_PARAM_ENABLED_battery_watt]){
                     ImguiNextColumnOrNewRow();
+                    std::string prefix = "";
+                    if (Battery_Stats.current_status == "Charging") {
+                        prefix = "+"; //
+                    } else if (Battery_Stats.current_status == "Discharging") {
+                        prefix = "-"; //
+                    }
                     if (HUDElements.params->enabled[OVERLAY_PARAM_ENABLED_hud_compact] && Battery_Stats.current_watt >= 10.0f)
                         right_aligned_text(HUDElements.colors.text, HUDElements.ralign_width, "%.0f", Battery_Stats.current_watt);
                     else
                         right_aligned_text(HUDElements.colors.text, HUDElements.ralign_width, "%.1f", Battery_Stats.current_watt);
                     ImGui::SameLine(0,1.0f);
                     ImGui::PushFont(HUDElements.sw_stats->font_small);
-                    HUDElements.TextColored(HUDElements.colors.text, "W");
+                    HUDElements.TextColored(HUDElements.colors.text, "%sW", prefix.c_str());
                     ImGui::PopFont();
                 }
                 if (HUDElements.params->enabled[OVERLAY_PARAM_ENABLED_battery_time]) {
-- 
2.51.2

